<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Painel do Usuário | Projeto X</title>
</head>
<body>
  <h2>Painel do Usuário</h2>
  <p>Saldo disponível (R$): <span id="saldo">0</span></p>
  
  <h3>Depositar Moeda X</h3>
  <input id="deposito" type="number" placeholder="Valor em R$" />
  <button onclick="depositar()">Depositar</button>
  <div id="msg"></div>

  <script src="../supabase.js"></script>
  <script>
    async function atualizarSaldo() {
      const { data: sessionData } = await supabase.auth.getSession();
      const userEmail = sessionData.session.user.email;

      const { data: user } = await supabase
        .from("users")
        .select("saldo")
        .eq("email", userEmail)
        .single();

      document.getElementById("saldo").innerText = user.saldo;
    }

    async function depositar() {
      const valor = parseFloat(document.getElementById("deposito").value);
      const msg = document.getElementById("msg");
      if (isNaN(valor) || valor <= 0) {
        msg.innerText = "Informe um valor válido";
        msg.style.color = "red";
        return;
      }

      const { data: sessionData } = await supabase.auth.getSession();
      const userEmail = sessionData.session.user.email;

      await supabase
        .from("users")
        .update({ saldo: supabase.raw("saldo + ?", [valor]) })
        .eq("email", userEmail);

      msg.innerText = `Depósito de ${valor} Moeda X realizado com sucesso!`;
      msg.style.color = "green";
      atualizarSaldo();
    }

    atualizarSaldo();
  </script>
</body>
</html>
