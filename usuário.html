<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Projeto X – Painel do Usuário</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0; font-family:Arial,sans-serif; background:#0f172a; color:#e5e7eb;}
header{background:#020617; padding:20px; text-align:center;}
h1{color:#38bdf8;}
.container{max-width:900px; margin:20px auto; padding:20px;}
.card{background:#020617; padding:20px; border-radius:10px; margin-bottom:20px;}
button{padding:10px 20px; border:none; border-radius:6px; background:#2563eb; color:#fff; cursor:pointer;}
button:hover{background:#1d4ed8;}
#historico{max-height:200px; overflow-y:auto; margin-top:10px;}
</style>
</head>
<body>

<header>
  <h1>Painel do Usuário</h1>
</header>

<div class="container">
  <div class="card">
    <h2>Carteira</h2>
    <p>Saldo Livre: R$ <span id="saldoLivre">100,00</span></p>
    <p>Saldo do Plano B: R$ <span id="saldoPlano">0,00</span></p>
  </div>

  <div class="card plano-status">
    <h2>Plano B – Gestão de Saldo</h2>
    <p>Status: <span id="statusPlano">Inativo</span></p>
    <p>Tempo restante: <span id="tempoRestante">00d 00h 00m</span></p>
    <p>Saldo investido: R$ <span id="saldoInvestidoPlano">0,00</span></p>
    <button onclick="encerrarPlano()">Encerrar Plano</button>
    <button onclick="ativarPlano()">Ativar Plano B (R$50)</button>
  </div>

  <div class="card">
    <h2>Histórico de Operações</h2>
    <div id="historico">
      <p>Nenhuma operação realizada ainda.</p>
    </div>
  </div>

  <button onclick="logout()">Sair</button>
</div>

<script>
// Simulação de saldo
let saldoLivre = parseFloat(localStorage.getItem("saldoLivre")) || 100;
let saldoPlano = parseFloat(localStorage.getItem("saldoPlano")) || 0;
let planoAtivo = localStorage.getItem("planoAtivo") === "true" || false;
let tempoInicial = parseInt(localStorage.getItem("tempoFimPlano")) || null;
let historico = JSON.parse(localStorage.getItem("historico")) || [];

function atualizarDashboard(){
  document.getElementById("saldoLivre").innerText = saldoLivre.toFixed(2);
  document.getElementById("saldoPlano").innerText = saldoPlano.toFixed(2);
  document.getElementById("saldoInvestidoPlano").innerText = saldoPlano.toFixed(2);

  if(planoAtivo && tempoInicial){
    const agora = new Date().getTime();
    let diff = tempoInicial - agora;
    if(diff <= 0){
      document.getElementById("statusPlano").innerText = "Encerrado";
      document.getElementById("tempoRestante").innerText = "00d 00h 00m";
      planoAtivo = false;
      localStorage.setItem("planoAtivo", false);
      saldoLivre += saldoPlano;
      saldoPlano = 0;
      localStorage.setItem("saldoLivre", saldoLivre);
      localStorage.setItem("saldoPlano", saldoPlano);
    } else {
      let dias = Math.floor(diff / (1000*60*60*24));
      let horas = Math.floor((diff % (1000*60*60*24)) / (1000*60*60));
      let minutos = Math.floor((diff % (1000*60*60)) / (1000*60));
      document.getElementById("tempoRestante").innerText = `${dias}d ${horas}h ${minutos}m`;
      document.getElementById("statusPlano").innerText = (dias<=1) ? "Expirando" : "Ativo";
    }
  } else {
    document.getElementById("statusPlano").innerText = "Inativo";
    document.getElementById("tempoRestante").innerText = "00d 00h 00m";
  }

  // Atualiza histórico
  const histDiv = document.getElementById("historico");
  if(historico.length === 0){
    histDiv.innerHTML = "<p>Nenhuma operação realizada ainda.</p>";
  } else {
    histDiv.innerHTML = historico.map(op=>`<p>${op}</p>`).join("");
  }
}

function ativarPlano(){
  if(saldoLivre < 50){ alert("Saldo insuficiente para ativar o plano."); return; }
  saldoLivre -= 50;
  saldoPlano += 50;
  planoAtivo = true;
  tempoInicial = new Date().getTime() + 10*24*60*60*1000; // 10 dias
  localStorage.setItem("saldoLivre", saldoLivre);
  localStorage.setItem("saldoPlano", saldoPlano);
  localStorage.setItem("planoAtivo", planoAtivo);
  localStorage.setItem("tempoFimPlano", tempoInicial);
  historico.push(`Plano B ativado: R$50,00 em ${new Date().toLocaleString()}`);
  localStorage.setItem("historico", JSON.stringify(historico));
  atualizarDashboard();
}

function encerrarPlano(){
  if(!planoAtivo){ alert("Plano não está ativo."); return; }
  planoAtivo = false;
  saldoLivre += saldoPlano;
  historico.push(`Plano B encerrado manualmente em ${new Date().toLocaleString()}`);
  saldoPlano = 0;
  localStorage.setItem("saldoLivre", saldoLivre);
  localStorage.setItem("saldoPlano", saldoPlano);
  localStorage.setItem("planoAtivo", planoAtivo);
  localStorage.setItem("historico", JSON.stringify(historico));
  atualizarDashboard();
}

function logout(){
  localStorage.removeItem("session");
  window.location.href = "login.html";
}

atualizarDashboard();
setInterval(atualizarDashboard, 1000);
</script>

</body>
</html>
